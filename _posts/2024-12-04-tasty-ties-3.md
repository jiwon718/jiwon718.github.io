---
title: "[ë§›ì‡ë‹¤] Spring Boot + WebSocket ì±„íŒ… ë©”ì„¸ì§€ ì €ì¥ with MongoDB"
date: 2024-12-04 22:32:00 +0900
categories: [Project]
tags: [ë§›ì‡ë‹¤, spring boot, websocket, mongodb]
---



ë§›ì‡ë‹¤ëŠ” ë²ˆì—­ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ëŠ” ì˜¨ë¼ì¸ ì¿ í‚¹ í´ë˜ìŠ¤ ì›¹ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤. ë§›ì‡ë‹¤ì— ì—¬ëŸ¬ ê°€ì§€ ê¸°ëŠ¥ì´ ìˆì§€ë§Œ, ê·¸ ì¤‘ì—ì„œ ì‚¬ìš©ìë“¤ ê°„ ë‹¤ëŒ€ë‹¤ ì±„íŒ…ì„ ë‹´ë‹¹í•˜ì—¬ ê°œë°œí•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë²ˆì—ëŠ” ê·¸ ì±„íŒ…ì„ ê°œë°œí•˜ëŠ” ê³¼ì • ì¤‘ ì„¸ ë²ˆì§¸ì¸ MongoDBì— ì±„íŒ… ë©”ì„¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒì„ êµ¬í˜„í•œ ê³¼ì •ì— ëŒ€í•´ì„œ ê³µìœ í•˜ë ¤ê³  í•©ë‹ˆë‹¤.

í•´ë‹¹ ë‚´ìš©ì€ ë‘ ë²ˆì§¸ ë‚´ìš©ì¸ [\[ë§›ì‡ë‹¤\] Spring Boot + WebSocketì„ í™œìš©í•œ ê°„ë‹¨í•œ ì±„íŒ…](https://jiwon718.github.io/posts/tasty-ties-2)ì—ì„œ ì´ì–´ì§„ ê²ƒì´ë¯€ë¡œ, ì´ì „ ê¸€ì„ ì½ìœ¼ì‹œë©´ í•´ë‹¹ ê¸€ì„ ì´í•´í•˜ì‹œëŠ” ë°ì— ë§ì€ ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.

ì´ì „ ê¸€ì—ì„œëŠ” êµ¬í˜„í•œ ì±„íŒ…ë°©ë³„ë¡œ ëŒ€í™”í•˜ëŠ” ê¸°ëŠ¥ì„ í† ëŒ€ë¡œ ì±„íŒ… ë©”ì„¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒì„ êµ¬í˜„í•˜ê² ìŠµë‹ˆë‹¤.



<br/><br/>



---

# ğŸ’¾ MongoDB ì„¤ì¹˜ ë° ì„¤ì •

## MongoDB ì„¤ì¹˜

[MongoDB ê³µì‹ ì‚¬ì´íŠ¸](https://www.mongodb.com/try/download/community)ë¡œ ë“¤ì–´ê°€ì„œ MongoDB Community Serverë¥¼ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.

<font color="#D9D7D8">ì°¸ê³ ë¡œ ì €ëŠ” ë‹¤ìš´ë¡œë“œí•  ë‹¹ì‹œ(2024.12.04)ì˜ currentì¸ 8.0.3ì¸ Window x 64ë¥¼ msië¡œ ë‹¤ìš´ë¡œë“œí•˜ì˜€ìŠµë‹ˆë‹¤.</font>

<br/>

MongoDB Community Serverë¥¼ ì„¤ì¹˜í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. ë‹¤ìš´ë¡œë“œí•œ msi íŒŒì¼ì„ ì‹¤í–‰í•œ í›„, ë‹¤ìŒ ê³¼ì •ì´ ë‚˜íƒ€ë‚  ë•Œê¹Œì§€ **Next** ë²„íŠ¼ì„ í´ë¦­í•´ì¤ë‹ˆë‹¤.
2. **Choose Setup Type** ë‹¨ê³„: **Complete** ë²„íŠ¼ì„ í´ë¦­í•´ì¤ë‹ˆë‹¤.
   : ì„¤ì¹˜ íƒ€ì…ì„ completeë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì¸ë°, customìœ¼ë¡œ í•˜ë©´ ë‹¤ì–‘í•œ ì„¤ì •ì„ í•  ìˆ˜ ìˆì§€ë§Œ í˜„ì¬ëŠ” í•™ìŠµìš©ì´ë¯€ë¡œ ì´ ë‹¨ê³„ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.
3. **Service Contifuration** ë‹¨ê³„: **Install MongoD as a Service**ì™€ **Run service as Network Service user** ì²´í¬ í‘œì‹œí•œ í›„ ì§„í–‰í•©ë‹ˆë‹¤.
   - MongoD: MongoDBì˜ MongoDì˜ ë°ëª¬ì„ ì„œë¹„ìŠ¤ë¡œ ì„¤ì¹˜í•˜ëŠ” ê²ƒìœ¼ë¡œ, ë°±ê·¸ë¼ìš´ë“œì—ì„œë„ ëŒì•„ê°€ê³  ìˆëŠ” ì„œë¹„ìŠ¤ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
   - Install MongoD as a Service: windowsì—ì„œ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ê´€ë¦¬ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ MongoDB ì„œë²„ë¥¼ ê´€ë¦¬í•´ì¤ë‹ˆë‹¤.
   - Run service as Network Service user: íŠ¹ì • ë„ë©”ì¸ì´ë‚˜ ë¡œì»¬ì—ì„œë§Œ ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
4. **Install MongoDB Compass** ë‹¨ê³„: í•˜ë‹¨ ë§¨ ë°‘ì— ìˆëŠ” **Install MongoDB Compass** ì²´í¬ í‘œì‹œí•œ í›„ ì§„í–‰í•©ë‹ˆë‹¤.
   - MongoDB Compass: MongoDBì— ì ‘ì†í•  ìˆ˜ ìˆëŠ” GUI Toolì´ë¯€ë¡œ ì›í•˜ì‹œëŠ” ê²½ìš°ì—ë§Œ ì²´í¬ í‘œì‹œí•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.


<br/>


## MongoDB ì„¤ì •

MongoDBì— ì±„íŒ… ì‹œìŠ¤í…œê³¼ ê´€ë ¨ëœ databaseë¥¼ ìƒì„±í•œ í›„, í•´ë‹¹ databaseì—ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì‚¬ìš©ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

> íŠ¹ì • databaseì—ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ì§€ ì•Šê³ , ê³„ì† ì§„í–‰í•˜ì…”ë„ ê´œì°®ìŠµë‹ˆë‹¤.  
> í•˜ì§€ë§Œ, admin ê³„ì •ìœ¼ë¡œ Spring Bootì—ì„œ ì ‘ê·¼í•˜ë©´ ë‹¤ë¥¸ ì¤‘ìš”í•œ databaseì—ë„ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë˜ë¯€ë¡œ ë³´ì•ˆìƒ ì¢‹ì§€ ì•Šë‹¤ê³  ìƒê°í•˜ì—¬ ì €ëŠ” ì±„íŒ… ì‹œìŠ¤í…œê³¼ ê´€ë ¨ëœ databaseì—ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤!


<br/>


### 1. connection ìƒì„±

![Desktop View](/assets/img/2024-12-03-tasty-ties-3/MongoDB%20connection%20ìƒì„±%201.png)
_MongoDB connection ìƒì„± 1_

MongoDB Compassì— ì ‘ì†í•´ì„œ **Add new connection** ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒˆë¡œìš´ connectionì„ ìƒì„± ì‹œë„í•©ë‹ˆë‹¤.

![Desktop View](/assets/img/2024-12-03-tasty-ties-3/MongoDB%20connection%20ìƒì„±%202.png)
_MongoDB connection ìƒì„± 2_

**Add new Connection** ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ìœ„ì™€ ê°™ì´ **New Connection**ì´ë¼ëŠ” í™”ë©´ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ì•„ë¬´ê²ƒë„ ë³€ê²½í•˜ì§€ ì•Šê³  ì¼ë‹¨ **Save & Connect** ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ connection ìƒì„±ì„ ì™„ë£Œí•©ë‹ˆë‹¤.


<br/>


### 2. MongoDB Shell ì ‘ì†

![Desktop View](/assets/img/2024-12-03-tasty-ties-3/MongoDB%20Shell%20ì ‘ì†.png)
_MongoDB Shell ì ‘ì†_

connectionì„ ì •ìƒì ìœ¼ë¡œ ìƒì„±í•˜ì˜€ë‹¤ë©´, ìœ„ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì—¬ê¸°ì„œ í•´ë‹¹ connection ì´ë¦„ ì˜†ì— **Open MongoDB Shell** ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ shellì— ì ‘ì†í•©ë‹ˆë‹¤.


<br/>


### 3. Database ë° ì‚¬ìš©ì ìƒì„±

MongoDB Shellì— ì ‘ì†í–ˆë‹¤ë©´ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ `tastyties`ì´ë¼ëŠ” databaseë¥¼ ìƒì„±í•˜ê³ , `tastyties`ì´ë¼ëŠ” databaseì—ë§Œ ì ‘ê·¼ê°€ëŠ¥í•œ ì‚¬ìš©ìë¥¼ ë§Œë“­ë‹ˆë‹¤.

```shell
use tastyties;
db.createUser({user: "tasty", pwd: "tastyjiwon0708", roles: ["readWrite"]});
```

- `use tastyties;`: `use` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ `tastyties`ë¼ëŠ” databaseë¥¼ ìƒì„±í•œ í›„, ì„ íƒí•©ë‹ˆë‹¤.
  - `use`: MongoDBì—ì„œ ì‚¬ìš©í•  databaseë¥¼ ì„ íƒí•˜ëŠ” ëª…ë ¹ì–´ë¡œ, ë§Œì•½ í•´ë‹¹ databaseê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤.
- `db.createUser(...);`: `tastyties` databaseì— ì½ê³  ì“¸ ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ê°€ì§„ `tastytes`ë¼ëŠ” ì´ë¦„ê³¼ `tastyjiwon0708`ë¼ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ê°€ì§„ ìœ ì €ë¥¼ ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤.
  - `user`: ì‚¬ìš©ìì˜ ì´ë¦„
  - `pwd`: ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸
  - `roles`: ì‚¬ìš©ìì˜ ê¶Œí•œ

<br/>

`db.getUsers();` ëª…ë ¹ì–´ë¥¼ í†µí•´ `tasty`ë¼ëŠ” ì‚¬ìš©ìê°€ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Desktop View](/assets/img/2024-12-03-tasty-ties-3/MongoDB%20database%20ë°%20ì‚¬ìš©ì%20ìƒì„±.png)
_MongoDB database ë° ì‚¬ìš©ì ìƒì„±_



<br/><br/>



---

# ğŸª› Spring Bootì™€ MongoDB ì—°ê²°

ì±„íŒ… ë©”ì„¸ì§€ë¥¼ ì €ì¥í•  MongoDB databaseë¥¼ ìƒì„±í•˜ì˜€ìœ¼ë‹ˆ, ì´ì œ Spring Bootì— í•´ë‹¹ `tastyties` databaseì™€ ì—°ê²°í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

Spring Bootì—ì„œ MongoDBë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ë‹¤ìŒ ì•„ë˜ íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

> - Spring Data MongoDB

<br/>

íŒ¨í‚¤ì§€ë¥¼ ë‹¤ ì¶”ê°€í–ˆìœ¼ë©´, **application.properties**ì—ì„œ í•´ë‹¹ MongoDBì— ëŒ€í•œ ì„¤ì •ì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

```properties
spring.data.mongodb.host=localhost
spring.data.mongodb.port=27017
spring.data.mongodb.database=tastyties
spring.data.mongodb.authentication-database=tastyties
spring.data.mongodb.username=tasty
spring.data.mongodb.password=tastyjiwon0708
spring.data.mongodb.auto-index-create=true
```

ì—¬ê¸°ì„œ `authentication-database`ë¥¼ ì ‘ì†í•˜ë ¤ëŠ” ì‚¬ìš©ìê°€ ìƒì„±ëœ databaseë¥¼ ì˜ë¯¸í•˜ëŠ” ê²ƒìœ¼ë¡œ, ì €í¬ëŠ” ì•ì„œ `tastyties`ë¼ëŠ” database ì•ˆì— ì‚¬ìš©ìë¥¼ ìƒì„±í–ˆìœ¼ë¯€ë¡œ `tastyties`ë¼ê³  ì‘ì„±í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

<br/>

![Desktop View](/assets/img/2024-12-03-tasty-ties-3/MongoDB%20ì—°ê²°%20ì„±ê³µ.png)
_MongoDB ì—°ê²° ì„±ê³µ_

MongoDBì™€ ì—°ê²°ì´ ì„±ê³µí•˜ë©´ ìœ„ì™€ ê°™ì´ ë¡œê·¸ê°€ ì°íˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



<br/><br/>



---

# ğŸ—¨ï¸ MongoDBì— ë©”ì„¸ì§€ ì €ì¥

## Configuration

ì±„íŒ… ë©”ì„¸ì§€ë¥¼ ì €ì¥í•  ë•Œ, ì €ì¥í•˜ëŠ” ì‹œì ì˜ ì‹œê°ì„ ìë™ìœ¼ë¡œ ì €ì¥í•˜ê¸° ìœ„í•´ì„œ MongoDBì˜ **Auditing** ê¸°ëŠ¥ì„ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ Spring Bootì—ì„œ MongoDB Auditingì€ í™œì„±í™”ë˜ì–´ ìˆì§€ ì•Šìœ¼ë¯€ë¡œ, ì•„ë˜ ì½”ë“œë¥¼ í†µí•´ Auditing ê¸°ëŠ¥ì„ í™œì„±í™”í•©ë‹ˆë‹¤.

> **MongoDB Auditing**
> - documentì—ì„œ íŠ¹ì • í•„ë“œë¥¼ ìë™ìœ¼ë¡œ ê´€ë¦¬í•´ì£¼ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.
> - `@CreatedData`ì™€ `@LastModifiedData` ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ì„œ documentì˜ ìƒì„± ë° ìˆ˜ì • ì‹œì ì„ ìë™ìœ¼ë¡œ ê¸°ë¡í•©ë‹ˆë‹¤.

```java
import org.springframework.context.annotation.Configuration;
import org.springframework.data.mongodb.config.EnableMongoAuditing;

@Configuration
@EnableMongoAuditing
public class MongoConfig {
}
```
{: file="config/MongoConfig.java"}

- `@EnableMongoAuditing`: í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ì„œ MongoDB Auditing ê¸°ëŠ¥ì„ í™œì„±í™”í•´ì¤ë‹ˆë‹¤.


<br/>


## Entity & Repository

ì±„íŒ… ë©”ì„¸ì§€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” entityì™€ ì´ì™€ ê´€ë ¨ëœ repositoryë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```java
import lombok.*;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.mapping.Document;

import java.time.Instant;

@Document(collection = "chatmessage")
@NoArgsConstructor
@AllArgsConstructor
@Getter
@Builder
public class ChatMessage {

    @Id
    private String id;
    private String roomId;
    private String username;
    private String message;
    @CreatedDate
    private Instant createdTime;

}
```
{: file="entity/ChatMessage.java"}

- `@Document(collection = "chatmessage")`
  - í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ì—¬ collection ì´ë¦„ì„ **chatmessage**ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
  - collection ì´ë¦„ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´, ê¸°ë³¸ì ìœ¼ë¡œ í´ë˜ìŠ¤ ì´ë¦„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
  - í´ë˜ìŠ¤ ì´ë¦„ì˜ ì²« ê¸€ìëŠ” ì†Œë¬¸ìë¡œ ë³€í™˜ë˜ì–´ ì‚¬ìš©í•©ë‹ˆë‹¤.
- `@CreatedDate` ~ `private Instant createdTime;`: ì±„íŒ… ë©”ì„¸ì§€ ì‘ì„± ë‚ ì§œë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ í•„ë“œë¡œ, `@CreatedDate` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì—”í„°í‹° ìƒì„± ë‚ ì§œ ë° ì‹œê°„ì„ ìë™ìœ¼ë¡œ ì…ë ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

> MongoDBì—ì„œ ì‹œê°„ ë°ì´í„°ë¥¼ `Date` íƒ€ì…ìœ¼ë¡œ ì €ì¥í•˜ëŠ”ë°, ISO 8601 í‘œì¤€ í˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ ë‚ ì§œì™€ ì‹œê°„ì„ ì €ì¥í•©ë‹ˆë‹¤. ë˜í•œ, ì‹œê°„ì„ ì €ì¥í•  ë•Œ UTC ê¸°ì¤€ìœ¼ë¡œ ì €ì¥ë˜ë©°, í•„ìš” ì‹œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ íƒ€ì„ì¡´ ë³€í™˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.  
> ì´ëŸ¬í•œ MongoDBì— ì‹œê°„ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ì„œ entityì—ì„œ ì–´ë–¤ ë°ì´í„° íƒ€ì…ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ì„ì§€ ê³ ë¯¼í•´ë´¤ìŠµë‹ˆë‹¤.
> - `Instant`: UTC ê¸°ì¤€ì˜ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ í‘œí˜„í•˜ë©°, MongoDBì™€ ì§ì ‘ì ìœ¼ë¡œ ë§¤í•‘ì´ ì‰½ìŠµë‹ˆë‹¤.
> - `LocalDateTime`: ì§€ì—­ ì‹œê°„ì„ í‘œí˜„í•˜ë©°, ì €ì¥ ì‹œ UTCë¡œ ë³€í™˜í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.  
> 
> ë§›ì‡ë‹¤ì˜ íƒ€ì¼“ì¸µì´ ì™¸êµ­ì¸ì¸ ì ì—ì„œ, í•œêµ­ì´ ì•„ë‹Œ ë‹¤ë¥¸ ë‚˜ë¼ì—ì„œë„ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ ìƒê°í•˜ì—¬ ì‹œê°„ ë°ì´í„°ëŠ” `String`ì´ ì•„ë‹Œ `Date` íƒ€ì…ìœ¼ë¡œ MongoDBì— ì €ì¥í•˜ëŠ” ê²ƒì´ ë” ì í•©í•˜ë‹¤ê³  ìƒê°í•˜ì˜€ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ, `LocalDateTime`ì€ UTCë¡œ ì €ì¥í•˜ê¸° ìœ„í•´ì„œëŠ” ë³€í™˜í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•˜ë‹¤ëŠ” ì ì—ì„œ `LocalDateTime`ë³´ë‹¤ëŠ” `Instant`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì ì ˆí•˜ë‹¤ ìƒê°í•˜ì˜€ìŠµë‹ˆë‹¤.

<br/>

```java
import com.example.chattingtest.entity.ChatMessage;
import org.springframework.data.mongodb.repository.MongoRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface ChatMessageRepository extends MongoRepository<ChatMessage, String> {
}
```
{: file="repository/ChatMessageRepository.java"}


<br/>


## Service

ì±„íŒ…ë°© IDì™€ ì‚¬ìš©ìì—ê²Œì„œ ì „ë‹¬ë°›ì€ ì±„íŒ… ë©”ì„¸ì§€ ì •ë³´(`ChatMessageRequestDto`)ì—ì„œ ì‚¬ìš©ì ì´ë¦„ê³¼ ë©”ì„¸ì§€ë¥¼ ì´ìš©í•˜ì—¬ DBì— ì €ì¥í•  ì •ë³´ë¥¼ entityë¡œ ë§Œë“  í›„, ì €ì¥í•©ë‹ˆë‹¤.

```java
import com.example.chattingtest.dto.ChatMessageRequestDto;
import com.example.chattingtest.entity.ChatMessage;
import com.example.chattingtest.repository.ChatMessageRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class ChatMessageServiceImpl implements ChatMessageService {

    private final ChatMessageRepository chatMessageRepository;

    @Autowired
    public ChatMessageServiceImpl(ChatMessageRepository chatMessageRepository) {
        this.chatMessageRepository = chatMessageRepository;
    }

    @Override
    public void saveChatMessage(String chatRoomId, ChatMessageRequestDto chatMessageDto) {
        ChatMessage chatMessage = ChatMessage.builder()
                .roomId(chatRoomId)
                .username(chatMessageDto.getUsername())
                .message(chatMessageDto.getMessage())
                .build();

        chatMessageRepository.save(chatMessage);
    }
}
```
{: file="service/ChatMessageServiceImpl.java"}


<br/>


## Controller

ìœ„ì—ì„œ ë§Œë“  serviceë¥¼ ì´ìš©í•˜ì—¬ ì±„íŒ… ë©”ì„¸ì§€ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

```java
import com.example.chattingtest.dto.ChatMessageRequestDto;
import com.example.chattingtest.dto.ChatMessageResponseDto;
import com.example.chattingtest.service.ChatMessageService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.messaging.handler.annotation.DestinationVariable;
import org.springframework.messaging.handler.annotation.MessageMapping;
import org.springframework.messaging.handler.annotation.Payload;
import org.springframework.messaging.handler.annotation.SendTo;
import org.springframework.stereotype.Controller;

@Slf4j
@Controller
public class ChatMessageController {

    private final ChatMessageService chatMessageService;

    public ChatMessageController(ChatMessageService chatMessageService) {
        this.chatMessageService = chatMessageService;
    }

    @MessageMapping("/chat/rooms/{roomId}")  // pub/chat/rooms/{roomId}ë¡œ ë³´ë‚¸ ë©”ì‹œì§€ ì²˜ë¦¬
    @SendTo("/sub/chat/rooms/{roomId}")  // sub/chat/rooms/{roomId}ë¥¼ êµ¬ë… ì¤‘ì¸ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡
    public ChatMessageResponseDto sendMessage(@DestinationVariable String roomId, @Payload ChatMessageRequestDto chatMessageRequestDto) throws Exception {
        // ì±„íŒ… ë©”ì„¸ì§€ ì €ì¥
        chatMessageService.saveChatMessage(roomId, chatMessageRequestDto);

        return ChatMessageResponseDto.builder()
                .username(chatMessageRequestDto.getUsername())
                .message(chatMessageRequestDto.getMessage())
                .build();
    }

}
```



<br/><br/>



---

# âœ¨ ì‹¤í–‰ ê²°ê³¼

1ë²ˆ ì±„íŒ…ë°©ì—ì„œ ë‘˜ë¦¬ê°€ "ì•ˆë…•?"ì´ë¼ê³  ë©”ì„¸ì§€ë¥¼ ì „ì†¡í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ MongoDBì— ì •ìƒì ìœ¼ë¡œ ì €ì¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Desktop View](/assets/img/2024-12-03-tasty-ties-3/MongoDB%20ë©”ì„¸ì§€%20ì €ì¥%20ì„±ê³µ.png)
_MongoDB ë©”ì„¸ì§€ ì €ì¥ ì„±ê³µ_



<br/><br/>



---

ì´ìƒ Spring Bootì™€ MongoDBë¥¼ ì—°ê²°í•œ í›„, ë©”ì„¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒì„ êµ¬í˜„í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.  
ë‹¤ìŒì—ëŠ” RabbitMQì„ ì´ìš©í•œ ë©”ì¸ ì„œë²„ì™€ì˜ ë¹„ë™ê¸° í†µì‹ ì„ êµ¬í˜„í•´ ë³´ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ˜†

<br/>

> - MongoDB Community Server: 8.0.3 

<br/>

[ğŸ³ GitHub - jiwon718/SpringBoot-Chat](https://github.com/jiwon718/SpringBoot_Chat)


<br/>


## ì°¸ê³ ìë£Œ

- [mongoDB ì¸ì¦ì„¤ì •í•˜ê¸°](https://bjcomm.co.kr/186)
- [MongoDB Authentication failed](https://velog.io/@ajm0718/MongoDB-Authentication-failed)
- [Date() ë° Datetime - MongoDB](https://www.mongodb.com/ko-kr/docs/manual/reference/method/Date/)

ë§ì€ ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.  
ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ¥°
